<!doctype html>
<html>

<head>
    <title>DASHBOARD</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
    <script src="http://www.chartjs.org/dist/2.7.1/Chart.js"></script>
    <script src="http://www.chartjs.org/samples/latest/utils.js"></script>

        <link rel="stylesheet" href="../css/style.css">
        <link rel="icon" href="../imagens/logo.png">
        
        <!-- Links para as fontes-->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Fira+Sans:wght@100;400&family=Poppins:wght@100;200;400&display=swap" rel="stylesheet">
<style>
      canvas {
            -moz-user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
        }
</style>

    </head>
    <body>
        <header id="header">
            <div class="container">
                <a href="../index.html">
                <img src="../imagens/logo.png" alt=""></a>
    
                <ul class="navbar">
                    <li >   <a href="../index.html"> <button class="voltar">voltar a pagina Inicial</button></a></li>
                </ul>
            </div>
        </header>
    <div>
        <div id="estatisticas">
            <div class="container">
                <div class="informacao azulescuro">
                    <p>Peixes cadastrados <br>
                    <span class="maior">6</span></p>
                </div>
                <div class="informacao azulmedio">
                    <p>Tanques cadastrados <br>
                    <span class="maior">6</span></p>
                </div>
                <div class="informacao azulclaro">
                    <p>Quantidade de Sensores <br>
                    <span class="maior">6</span></p>
                </div>
            </div>
        </div>
         <div id="diagramas">
             <p>Visualização de dados:</p>
             <div class="container">

               
               
                <section >
                    <canvas id="dht11Umidade" class="tamanho"></canvas>
                </section>
                <section >
                    <canvas id="dht11Temperatura" class="tamanho"></canvas>
                </section>
               </div>
               <div class="container" >
                
           
                <section >
                    <canvas id="luminosidade" class="tamanho"></canvas>
                </section>
                
                <section>
                    <canvas id="lm35Temperatura" class="tamanho"></canvas>
                </section>
            </div>
            <div class="container">
                <section >
                    <canvas id="chave" class="tamanho"></canvas>
                </section>
             </div>
         </div>
         <div id="footer" class="dashboard">
            <div class="container">
                
    
                <div class="contato">
                    <p><img src="../imagens/telefone.png">+55 11 11111-2222</p>
                    <p><img src="../imagens/o-email.png">name@sptech.school</p>
                    <p><img src="../imagens/pin.png">R. Haddock Lobo </p>
    
                </div>
                <img src="../imagens/peixe.png" alt="">
            </div>
        </div>

        <script>
            /* -- dht11Umidade -- */
            var contextoDht11Umidade = document.getElementById('dht11Umidade').getContext('2d');
           
            var dht11Umidade = new Chart(
                contextoDht11Umidade,
                {
                    type: 'line',
                    data: {
                        datasets: [{
                            label: 'Umidade',
                            type: 'line',
                            borderColor: ['#004860'],
                            backgroundColor: ['#004860']
                        }]
                    },
                    options: {
                        scales: {
                            xAxes: [{
                                distribution: 'series',
                                ticks: {
                                    beginAtZero: true
                                }
                            }],
                            yAxes: [{
                                scaleLabel: {
                                    display: true,
                                    labelString: 'Umidade'
                                },
                                ticks: {
                                    beginAtZero: true
                                }
                            }]
                        },
                        animation: {
                            duration: 0
                        }
                    }
                }
            );
            /* -- dht11Temperatura -- */
            var contextoDht11Temperatura = document.getElementById('dht11Temperatura').getContext('2d');
    
            var dht11Temperatura = new Chart(
                contextoDht11Temperatura,
                {
                    type: 'line',
                    data: {
                        datasets: [{
                            label: "Temperatura",
                            type: 'line',
                            borderColor: ['#004860'],
                            backgroundColor: ['#004860']
                        }]
                    },
                    options: {
                        scales: {
                            xAxes: [{
                                distribution: 'series',
                                ticks: {
                                    beginAtZero: true
                                }
                            }],
                            yAxes: [{
                                scaleLabel: {
                                    display: true,
                                    labelString: 'Luminosidade'
                                },
                                ticks: {
                                    beginAtZero: true
                                }
                            }]
                        },
                        animation: {
                            duration: 0
                        }
                    }
                }
            );
            /* -- luminosidade -- */
            var contextoLuminosidade = document.getElementById('luminosidade').getContext('2d');
            var luminosidade = new Chart(
                contextoLuminosidade,
                {
                    type: 'line',
                    data: {
                        datasets: [{
                            label: 'Luminosidade',
                            type: 'line',
                            borderColor: ['#007690'],
                            backgroundColor: ['#007690']
                        }]
                    },
                    options: {
                        scales: {
                            xAxes: [{
                                distribution: 'series',
                                ticks: {
                                    beginAtZero: true
                                }
                            }],
                            yAxes: [{
                                scaleLabel: {
                                    display: true,
                                    labelString: 'Luminosidade'
                                },
                                ticks: {
                                    beginAtZero: true
                                }
                            }]
                        },
                        animation: {
                            duration: 0
                        }
                    }
                }
            );
            /* -- lm35Temperatura */
            var contextoLm35Temperatura = document.getElementById('lm35Temperatura').getContext('2d');
            var lm35Temperatura = new Chart(
                contextoLm35Temperatura,
                {
                    type: 'line',
                    data: {
                        datasets: [{
                            label: 'Temperatura',
                            type: 'line',
                            borderColor: ['#007690'],
                            backgroundColor: ['#007690']
                        }]
                    },
                    options: {
                        scales: {
                            xAxes: [{
                                distribution: 'series',
                                ticks: {
                                    beginAtZero: true
                                }
                            }],
                            yAxes: [{
                                scaleLabel: {
                                    display: true,
                                    labelString: 'Temperatura'
                                },
                                ticks: {
                                    beginAtZero: true
                                }
                            }]
                        },
                        animation: {
                            duration: 0
                        }
                    }
                }
            );
            /* -- chave */
            var contextoChave = document.getElementById('chave').getContext('2d');
            var chave = new Chart(
                contextoChave,
                {
                    type: 'line',
                    data: {
                        datasets: [{
                            label: 'Chave',
                            type: 'line',
                            borderColor: ['#00B1CB'],
                            backgroundColor: ['#00B1CB']
                        }]
                    },
                    options: {
                        scales: {
                            xAxes: [{
                                distribution: 'series',
                                ticks: {
                                    beginAtZero: true
                                }
                            }],
                            yAxes: [{
                                scaleLabel: {
                                    display: true,
                                    labelString: 'Chave'
                                },
                                ticks: {
                                    beginAtZero: true
                                }
                            }]
                        },
                        animation: {
                            duration: 0
                        }
                    }
                }
            );
    
            var paginacao = {};
            var tempo = {};
            function obterDados(grafico, endpoint) {
                var http = new XMLHttpRequest();
                http.open('GET', 'http://localhost:3000/sensores/' + endpoint, false);
                http.send(null);
                var valores = JSON.parse(http.responseText);
                if (paginacao[endpoint] == null) {
                    paginacao[endpoint] = 0;
                }
                if (tempo[endpoint] == null) {
                    tempo[endpoint] = 0;
                }
                // Exibir à partir do último elemento exibido anteriormente
                var ultimaPaginacao = paginacao[endpoint];
                paginacao[endpoint] = valores.length;
                var valores = valores.slice(ultimaPaginacao);
                valores.forEach((valor) => {
                    //Máximo de 60 itens exibidos no gráfico
                    if (grafico.data.labels.length == 10 && grafico.data.datasets[0].data.length == 10) {
                        grafico.data.labels.shift();
                        grafico.data.datasets[0].data.shift();
                    }
    
                    grafico.data.labels.push(tempo[endpoint]++);
                    grafico.data.datasets[0].data.push(parseFloat(valor));
                    grafico.update();
                })
            }
    
            setInterval(() => {
                obterDados(dht11Umidade, 'dht11/umidade');
                obterDados(dht11Temperatura, 'dht11/temperatura');
                obterDados(luminosidade, 'luminosidade');
                obterDados(lm35Temperatura, 'lm35/temperatura');
                obterDados(chave, 'chave');
            }, 1000);
    
        </script>
    </body>
    
    </html>